---
interface Festival {
  name: string;
  start: string;
  end:   string;
  logo?: string;
  image?: string;
  video?: string;
  bg?:   string;   // NEW  background colour
  text?: string;   // NEW  text colour
  description: string;
}
const { festivals }:{ festivals: Festival[] } = Astro.props;

/* chronological order */
festivals.sort((a,b)=>new Date(a.start).valueOf()-new Date(b.start).valueOf());
---

<ul class="timeline-wrapper">
  {festivals.map(f => {
    const bg   = f.bg   || '#f3f4f6';   // pastel default
    const text = f.text || 'inherit';   // inherits parent colour
    const dot  = bg;
    return (
      <li class="timeline-item">
        <div class="timeline-dot" style={`background-color:${dot}`}></div>

        <div
          class="timeline-card"
          style={`background-color:${bg}; color:${text}`}
        >
          {f.logo && (
            <img src={`/src/assets/${f.logo}`} alt={`${f.name} logo`}
                 class="w-14 h-14 object-contain shrink-0"/>
          )}

          {f.image && (
            <img src={`/src/assets/${f.image}`} alt={f.name}
                 class="w-full sm:w-56 h-36 object-cover rounded-md shadow mb-3 sm:mb-0"/>
          )}

          <div class="flex-1">
            <h3 class="text-lg font-semibold leading-tight">{f.name}</h3>
            <p class="text-sm opacity-80 mb-2">
              {new Date(f.start).toLocaleDateString('en-GB',{day:'numeric',month:'short'})}
              &nbsp;â€“&nbsp;
              {new Date(f.end).toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'})}
            </p>

            <p class="text-justify whitespace-pre-line">{f.description}</p>

            {f.video && (
              <div class="mt-4">
                <iframe
                  src={f.video}
                  loading="lazy"
                  class="w-full aspect-video rounded-md"
                  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                />
              </div>
            )}
          </div>
        </div>
      </li>
    );
  })}
</ul>
